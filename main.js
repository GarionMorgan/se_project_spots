(()=>{"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__submit-btn_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"},t=(e,t,r)=>{const o=e.querySelector(`#${t.id}-error`);t.classList.remove(r.inputErrorClass),o.textContent=""},r=(e,t,r)=>{(e=>e.some(e=>!e.validity.valid))(e)?o(t,r):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))},o=(e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)},n=e=>{document.querySelectorAll(e.formSelector).forEach(o=>{((e,o)=>{const n=Array.from(e.querySelectorAll(o.inputSelector)),a=e.querySelector(o.submitButtonSelector);r(n,a,o),n.forEach(s=>{s.addEventListener("input",()=>{((e,r,o)=>{r.validity.valid?t(e,r,o):((e,t,r,o)=>{e.querySelector(`#${t.id}-error`).textContent=r,t.classList.add(o.inputErrorClass)})(e,r,r.validationMessage,o)})(e,s,o),r(n,a,o)})})})(o,e)})};function a(e,t,r="Save",o="Saving..."){e.textContent=t?o:r}n(e);const s=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._checkResponse)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(this._checkResponse)}editUserInfo({name:e,about:t}){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(this._checkResponse)}editAvatarInfo({avatar:e}){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._checkResponse)}postCard({link:e,caption:t}){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({link:e,name:t})}).then(this._checkResponse)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}handleLike(e,t){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:t?"DELETE":"PUT",headers:this._headers}).then(this._checkResponse)}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"e94a018e-c690-4742-811e-7105b58943cf","Content-Type":"application/json"}});s.getAppInfo().then(([e,t])=>{e.forEach(e=>{!function(e,t="append"){const r=N(e);w[t](r)}(e,"prepend")}),h.textContent=t.name,v.textContent=t.about,_.src=t.avatar,u.value=t.name,m.value=t.about}).catch(e=>{console.log(`Error: ${e}`)});const c=document.querySelector(".profile__edit-btn"),l=document.querySelector("#edit-profile-modal"),i=l.querySelector(".modal__close-btn"),d=l.querySelector(".modal__form"),u=l.querySelector("#profile-name-input"),m=l.querySelector("#profile-description-input"),_=document.querySelector(".profile__avatar"),h=document.querySelector(".profile__name"),v=document.querySelector(".profile__description"),p=document.querySelector("#preview-modal"),y=p.querySelector(".modal__image"),b=p.querySelector(".modal__caption"),S=document.querySelector(".profile__add-btn"),f=document.querySelector("#new-post-modal"),q=f.querySelector(".modal__submit-btn"),k=f.querySelector(".modal__close-btn"),E=f.querySelector(".modal__form"),L=f.querySelector("#card-image-input"),C=f.querySelector("#card-description-input"),g=document.querySelector(".profile__avatar-btn"),U=document.querySelector("#edit-avatar-modal"),$=U.querySelector(".modal__submit-btn"),x=U.querySelector(".modal__close-btn"),I=U.querySelector(".modal__form"),A=U.querySelector("#profile-avatar-input"),R=document.querySelector("#delete-card-modal"),B=R.querySelector(".modal__form"),T=R.querySelector(".modal__close-btn"),D=R.querySelector(".modal__cancel-card-btn"),P=document.querySelector("#card-template").content.querySelector(".card"),w=document.querySelector(".cards__list");function N(e){const t=P.cloneNode(!0),r=t.querySelector(".card__title"),o=t.querySelector(".card__image");o.src=e.link,o.alt=e.name,r.textContent=e.name;const n=t.querySelector(".card__like-btn");return e.isLiked?n.classList.add("card__like-btn_active"):n.classList.remove("card__like-btn_active"),n.addEventListener("click",()=>M(e._id,n)),t.querySelector(".card__delete-btn").addEventListener("click",()=>{z(t,e._id)}),o.addEventListener("click",()=>{y.src=e.link,y.alt=e.name,b.textContent=e.name,O(p)}),t}const O=e=>{e.classList.add("modal_is-opened"),document.addEventListener("keydown",J),e.addEventListener("click",H)},j=e=>{e.classList.remove("modal_is-opened"),document.removeEventListener("keydown",J),e.removeEventListener("click",H)},J=e=>{if("Escape"===e.key){const e=document.querySelector(".modal_is-opened");e&&j(e)}},H=e=>{e.target.classList.contains("modal_is-opened")&&j(e.target)};D.addEventListener("click",()=>{const e=document.getElementById("delete-card-modal");j(e)});const z=(e,t)=>{F=e,G=t,O(R)},M=(e,t)=>{const r=t.classList.contains("card__like-btn_active");r?s.handleLike(e,r).then(()=>{t.classList.remove("card__like-btn_active")}).catch(console.error):s.handleLike(e,r).then(()=>{t.classList.add("card__like-btn_active")}).catch(console.error)};let F,G;document.querySelectorAll(".modal__close-btn").forEach(e=>{const t=e.closest(".modal");e.addEventListener("click",()=>j(t))}),c.addEventListener("click",()=>{u.value=h.textContent,m.value=v.textContent,((e,r,n)=>{r.forEach(r=>{t(e,r,n)});const a=e.querySelector(n.submitButtonSelector);o(a,n)})(d,[u,m],e),O(l)}),i.addEventListener("click",()=>{j(l)}),d.addEventListener("submit",function(e){e.preventDefault();const t=e.submitter;a(t,!0),s.editUserInfo({name:u.value,about:m.value}).then(e=>{h.textContent=e.name,v.textContent=e.about,j(l)}).catch(console.error).finally(()=>{a(t,!1)})}),S.addEventListener("click",()=>{O(f)}),k.addEventListener("click",()=>{j(f)}),E.addEventListener("submit",t=>{t.preventDefault();const r=t.submitter;a(r,!0),s.postCard({link:L.value,caption:C.value}).then(t=>{const r=N(t);w.prepend(r),E.reset(),o(q,e),j(f)}).catch(console.error).finally(()=>{a(r,!1)})}),g.addEventListener("click",()=>{O(U)}),x.addEventListener("click",()=>{j(U)}),I.addEventListener("submit",t=>{t.preventDefault();const r=t.submitter;a(r,!0),s.editAvatarInfo({avatar:A.value}).then(t=>{console.log(t.avatar),_.src=t.avatar,I.reset(),o($,e),j(U)}).catch(console.error).finally(()=>{a(r,!1)})}),T.addEventListener("click",()=>{j(R)}),B.addEventListener("submit",e=>{e.preventDefault();const t=e.submitter;a(t,!0),s.deleteCard(G).then(()=>{console.log("Card deleted"),F.remove(),j(R)}).catch(console.error).finally(()=>{a(t,!1)})}),n(e)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFBS3pELE9BQzNCaUQsRUFBV3lDLFFBQ1hySSxFQUFXMEYsRUFBaUJuSCxHQUM1QnlJLEVBQVd2QixLQUVabkIsTUFBTUUsUUFBUW9ELE9BQ2RPLFFBQVEsS0FDUHBILEVBQWNrSCxHQUFXLE9BSy9CakMsRUFBbUJ0RixpQkFBaUIsUUFBUyxLQUMzQ3NHLEVBQVdsQixLQUdiQyxFQUFXckYsaUJBQWlCLFNBbEtJd0csSUFDOUJBLEVBQUljLGlCQUVKLE1BQU1DLEVBQVlmLEVBQUlnQixVQUN0Qm5ILEVBQWNrSCxHQUFXLEdBRXpCN0csRUFDRzJCLFdBQVcyRSxHQUNYekYsS0FBSyxLQUNKdUMsUUFBUUMsSUFBSSxnQkFDWmdELEVBQWFuSSxTQUNiMEgsRUFBV2xCLEtBRVp4QixNQUFNRSxRQUFRb0QsT0FDZE8sUUFBUSxLQUNQcEgsRUFBY2tILEdBQVcsT0F1Si9COUgsRUFBaUI1QixFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9zY3JpcHRzL3ZhbGlkYXRpb24uanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy91dGlscy9oZWxwZXJzLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy91dGlscy9BcGkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IHNldHRpbmdzID0ge1xuICBmb3JtU2VsZWN0b3I6IFwiLm1vZGFsX19mb3JtXCIsXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIubW9kYWxfX3N1Ym1pdC1idG5cIixcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJtb2RhbF9fc3VibWl0LWJ0bl9kaXNhYmxlZFwiLFxuICBpbnB1dEVycm9yQ2xhc3M6IFwibW9kYWxfX2lucHV0X3R5cGVfZXJyb3JcIixcbiAgZXJyb3JDbGFzczogXCJtb2RhbF9fZXJyb3JfdmlzaWJsZVwiLFxufTtcblxuY29uc3Qgc2hvd0lucHV0RXJyb3IgPSAoZm9ybUVsLCBpbnB1dEVsLCBlcnJvck1lc3NhZ2UsIGNvbmZpZykgPT4ge1xuICBjb25zdCBlcnJvckVsID0gZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWwuaWR9LWVycm9yYCk7XG4gIGVycm9yRWwudGV4dENvbnRlbnQgPSBlcnJvck1lc3NhZ2U7XG4gIGlucHV0RWwuY2xhc3NMaXN0LmFkZChjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcbn07XG5cbmNvbnN0IGhpZGVJbnB1dEVycm9yID0gKGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKSA9PiB7XG4gIGNvbnN0IGVycm9yRWwgPSBmb3JtRWwucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbC5pZH0tZXJyb3JgKTtcblxuICBpbnB1dEVsLmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmlucHV0RXJyb3JDbGFzcyk7XG4gIGVycm9yRWwudGV4dENvbnRlbnQgPSBcIlwiO1xufTtcblxuY29uc3QgY2hlY2tJbnB1dFZhbGlkaXR5ID0gKGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKSA9PiB7XG4gIGlmICghaW5wdXRFbC52YWxpZGl0eS52YWxpZCkge1xuICAgIHNob3dJbnB1dEVycm9yKGZvcm1FbCwgaW5wdXRFbCwgaW5wdXRFbC52YWxpZGF0aW9uTWVzc2FnZSwgY29uZmlnKTtcbiAgfSBlbHNlIHtcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWwsIGlucHV0RWwsIGNvbmZpZyk7XG4gIH1cbn07XG5cbmNvbnN0IGhhc0ludmFsaWRJbnB1dCA9IChpbnB1dExpc3QpID0+IHtcbiAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dCkgPT4ge1xuICAgIHJldHVybiAhaW5wdXQudmFsaWRpdHkudmFsaWQ7XG4gIH0pO1xufTtcblxuY29uc3QgdG9nZ2xlQnV0dG9uU3RhdGUgPSAoaW5wdXRMaXN0LCBidXR0b25FbCwgY29uZmlnKSA9PiB7XG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xuICAgIGRpc2FibGVCdG4oYnV0dG9uRWwsIGNvbmZpZyk7XG4gIH0gZWxzZSB7XG4gICAgYnV0dG9uRWwuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICBidXR0b25FbC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IGRpc2FibGVCdG4gPSAoYnV0dG9uRWwsIGNvbmZpZykgPT4ge1xuICBidXR0b25FbC5kaXNhYmxlZCA9IHRydWU7XG4gIGJ1dHRvbkVsLmNsYXNzTGlzdC5hZGQoY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xufTtcblxuZXhwb3J0IGNvbnN0IHJlc2V0VmFsaWRhdGlvbiA9IChmb3JtRWwsIGlucHV0TGlzdCwgY29uZmlnKSA9PiB7XG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsKSA9PiB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsLCBpbnB1dEVsLCBjb25maWcpO1xuICB9KTtcbiAgY29uc3QgYnV0dG9uRWwgPSBmb3JtRWwucXVlcnlTZWxlY3Rvcihjb25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xuICBkaXNhYmxlQnRuKGJ1dHRvbkVsLCBjb25maWcpO1xufTtcblxuY29uc3Qgc2V0RXZlbnRMaXN0ZW5lcnMgPSAoZm9ybUVsLCBjb25maWcpID0+IHtcbiAgY29uc3QgaW5wdXRMaXN0ID0gQXJyYXkuZnJvbShmb3JtRWwucXVlcnlTZWxlY3RvckFsbChjb25maWcuaW5wdXRTZWxlY3RvcikpO1xuICBjb25zdCBidXR0b25FbCA9IGZvcm1FbC5xdWVyeVNlbGVjdG9yKGNvbmZpZy5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XG5cbiAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbCwgY29uZmlnKTtcblxuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbCkgPT4ge1xuICAgIGlucHV0RWwuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgIGNoZWNrSW5wdXRWYWxpZGl0eShmb3JtRWwsIGlucHV0RWwsIGNvbmZpZyk7XG4gICAgICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsLCBjb25maWcpO1xuICAgIH0pO1xuICB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCBlbmFibGVWYWxpZGF0aW9uID0gKGNvbmZpZykgPT4ge1xuICBjb25zdCBmb3JtTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmZvcm1TZWxlY3Rvcik7XG4gIGZvcm1MaXN0LmZvckVhY2goKGZvcm1FbCkgPT4ge1xuICAgIHNldEV2ZW50TGlzdGVuZXJzKGZvcm1FbCwgY29uZmlnKTtcbiAgfSk7XG59O1xuXG5lbmFibGVWYWxpZGF0aW9uKHNldHRpbmdzKTtcbiIsImV4cG9ydCBmdW5jdGlvbiBzZXRCdXR0b25UZXh0KFxuICBidG4sXG4gIGlzTG9hZGluZyxcbiAgZGVmYXVsdFRleHQgPSBcIlNhdmVcIixcbiAgbG9hZGluZ1RleHQgPSBcIlNhdmluZy4uLlwiXG4pIHtcbiAgaWYgKGlzTG9hZGluZykge1xuICAgIGJ0bi50ZXh0Q29udGVudCA9IGxvYWRpbmdUZXh0O1xuICB9IGVsc2Uge1xuICAgIGJ0bi50ZXh0Q29udGVudCA9IGRlZmF1bHRUZXh0O1xuICB9XG59XG4iLCJpbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xuaW1wb3J0IHtcbiAgZW5hYmxlVmFsaWRhdGlvbixcbiAgc2V0dGluZ3MsXG4gIGRpc2FibGVCdG4sXG4gIHJlc2V0VmFsaWRhdGlvbixcbn0gZnJvbSBcIi4uL3NjcmlwdHMvdmFsaWRhdGlvbi5qc1wiO1xuaW1wb3J0IEFwaSBmcm9tIFwiLi4vdXRpbHMvQXBpLmpzXCI7XG5pbXBvcnQgeyBzZXRCdXR0b25UZXh0IH0gZnJvbSBcIi4uL3V0aWxzL2hlbHBlcnMuanNcIjtcblxuLy9DYXJkcyBhcnJheVxuLy8gY29uc3QgaW5pdGlhbENhcmRzID0gW1xuLy8gICB7XG4vLyAgICAgbmFtZTogXCJHb2xkZW4gR2F0ZSBCcmlkZ2VcIixcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvNy1waG90by1ieS1ncmlmZmluLXdvb2xkcmlkZ2UtZnJvbS1wZXhlbHMuanBnXCIsXG4vLyAgIH0sXG4vLyAgIHtcbi8vICAgICBuYW1lOiBcIlZhbCBUaG9yZW5zXCIsXG4vLyAgICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL3Nwb3RzLzEtcGhvdG8tYnktbW9yaXR6LWZlbGRtYW5uLWZyb20tcGV4ZWxzLmpwZ1wiLFxuLy8gICB9LFxuLy8gICB7XG4vLyAgICAgbmFtZTogXCJSZXN0YXVyYW50IHRlcnJhY2VcIixcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvMi1waG90by1ieS1jZWlsaW5lLWZyb20tcGV4ZWxzLmpwZ1wiLFxuLy8gICB9LFxuLy8gICB7XG4vLyAgICAgbmFtZTogXCJBbiBvdXRkb29yIGNhZmVcIixcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvMy1waG90by1ieS10dWJhbnVyLWRvZ2FuLWZyb20tcGV4ZWxzLmpwZ1wiLFxuLy8gICB9LFxuLy8gICB7XG4vLyAgICAgbmFtZTogXCJBIHZlcnkgbG9uZyBicmlkZ2UsIG92ZXIgdGhlIGZvcmVzdCBhbmQgdGhyb3VnaCB0aGUgdHJlZXNcIixcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvNC1waG90by1ieS1tYXVyaWNlLWxhc2NoZXQtZnJvbS1wZXhlbHMuanBnXCIsXG4vLyAgIH0sXG4vLyAgIHtcbi8vICAgICBuYW1lOiBcIlR1bm5lbCB3aXRoIG1vcm5pbmcgbGlnaHRcIixcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvNS1waG90by1ieS12YW4tYW5oLW5ndXllbi1mcm9tLXBleGVscy5qcGdcIixcbi8vICAgfSxcbi8vICAge1xuLy8gICAgIG5hbWU6IFwiTW91bnRhaW4gaG91c2VcIixcbi8vICAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvc3BvdHMvNi1waG90by1ieS1tb3JpdHotZmVsZG1hbm4tZnJvbS1wZXhlbHMuanBnXCIsXG4vLyAgIH0sXG4vLyBdO1xuXG5jb25zdCBhcGkgPSBuZXcgQXBpKHtcbiAgYmFzZVVybDogXCJodHRwczovL2Fyb3VuZC1hcGkuZW4udHJpcGxldGVuLXNlcnZpY2VzLmNvbS92MVwiLFxuICBoZWFkZXJzOiB7XG4gICAgYXV0aG9yaXphdGlvbjogXCJlOTRhMDE4ZS1jNjkwLTQ3NDItODExZS03MTA1YjU4OTQzY2ZcIixcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgfSxcbn0pO1xuLy9GZXRjaCBpbml0aWFsIGNhcmRzIGFuZCB1c2VyIGluZm8gZnJvbSB0aGUgYXBpXG5hcGlcbiAgLmdldEFwcEluZm8oKVxuICAudGhlbigoW2NhcmRzLCBwcm9maWxlXSkgPT4ge1xuICAgIGNhcmRzLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgIGZ1bmN0aW9uIHJlbmRlckNhcmQoaXRlbSwgbWV0aG9kID0gXCJhcHBlbmRcIikge1xuICAgICAgICBjb25zdCBjYXJkRWxlbWVudCA9IGdldENhcmRFbGVtZW50KGl0ZW0pO1xuXG4gICAgICAgIGNhcmRzTGlzdFttZXRob2RdKGNhcmRFbGVtZW50KTtcbiAgICAgIH1cbiAgICAgIHJlbmRlckNhcmQoaXRlbSwgXCJwcmVwZW5kXCIpO1xuICAgIH0pO1xuICAgIHByb2ZpbGVOYW1lRWwudGV4dENvbnRlbnQgPSBwcm9maWxlLm5hbWU7XG4gICAgcHJvZmlsZURlc2NyaXB0aW9uRWwudGV4dENvbnRlbnQgPSBwcm9maWxlLmFib3V0O1xuICAgIHByb2ZpbGVBdmF0YXJFbC5zcmMgPSBwcm9maWxlLmF2YXRhcjtcbiAgICBlZGl0UHJvZmlsZU5hbWVJbnB1dC52YWx1ZSA9IHByb2ZpbGUubmFtZTtcbiAgICBlZGl0UHJvZmlsZURlc2NyaXB0aW9uSW5wdXQudmFsdWUgPSBwcm9maWxlLmFib3V0O1xuICB9KVxuICAuY2F0Y2goKGVycikgPT4ge1xuICAgIGNvbnNvbGUubG9nKGBFcnJvcjogJHtlcnJ9YCk7XG4gIH0pO1xuXG4vL0VkaXQgUHJvZmlsZSBNb2RhbFxuY29uc3QgZWRpdFByb2ZpbGVCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtYnRuXCIpO1xuY29uc3QgZWRpdFByb2ZpbGVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdC1wcm9maWxlLW1vZGFsXCIpO1xuY29uc3QgZWRpdFByb2ZpbGVDbG9zZUJ0biA9IGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnRuXCIpO1xuY29uc3QgZWRpdFByb2ZpbGVGb3JtID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuY29uc3QgZWRpdFByb2ZpbGVOYW1lSW5wdXQgPSBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI3Byb2ZpbGUtbmFtZS1pbnB1dFwiXG4pO1xuY29uc3QgZWRpdFByb2ZpbGVEZXNjcmlwdGlvbklucHV0ID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIiNwcm9maWxlLWRlc2NyaXB0aW9uLWlucHV0XCJcbik7XG5jb25zdCBwcm9maWxlQXZhdGFyRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhclwiKTtcbmNvbnN0IHByb2ZpbGVOYW1lRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX25hbWVcIik7XG5jb25zdCBwcm9maWxlRGVzY3JpcHRpb25FbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIik7XG5cbi8vUHJldmlldyBNb2RhbFxuY29uc3QgcHJldmlld01vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcmV2aWV3LW1vZGFsXCIpO1xuY29uc3QgcHJldmlld0ltYWdlRWwgPSBwcmV2aWV3TW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9faW1hZ2VcIik7XG5jb25zdCBwcmV2aWV3Q2FwdGlvbkVsID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2NhcHRpb25cIik7XG5cbi8vTmV3IFBvc3QgTW9kYWxcbmNvbnN0IG5ld1Bvc3RCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2FkZC1idG5cIik7XG5jb25zdCBuZXdQb3N0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI25ldy1wb3N0LW1vZGFsXCIpO1xuY29uc3QgbmV3UG9zdFN1Ym1pdEJ0biA9IG5ld1Bvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zdWJtaXQtYnRuXCIpO1xuY29uc3QgbmV3UG9zdENsb3NlQnRuID0gbmV3UG9zdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcbmNvbnN0IG5ld1Bvc3RGb3JtID0gbmV3UG9zdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG5jb25zdCBuZXdQb3N0SW1hZ2VJbnB1dCA9IG5ld1Bvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtaW1hZ2UtaW5wdXRcIik7XG5jb25zdCBuZXdQb3N0RGVzY3JpcHRpb25JbnB1dCA9IG5ld1Bvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIiNjYXJkLWRlc2NyaXB0aW9uLWlucHV0XCJcbik7XG4vL0F2YXRhciBFZGl0IE1vZGFsXG5jb25zdCBhdmF0YXJNb2RhbEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyLWJ0blwiKTtcbmNvbnN0IGF2YXRhck1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNlZGl0LWF2YXRhci1tb2RhbFwiKTtcbmNvbnN0IGF2YXRhclN1Ym1pdEJ0biA9IGF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idG5cIik7XG5jb25zdCBhdmF0YXJDbG9zZUJ0biA9IGF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcbmNvbnN0IGF2YXRhckZvcm0gPSBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuY29uc3QgYXZhdGFySW5wdXQgPSBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtYXZhdGFyLWlucHV0XCIpO1xuLy9EZWxldGUgQ2FyZCBNb2RhbFxuY29uc3QgZGVsZXRlQ2FyZE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNkZWxldGUtY2FyZC1tb2RhbFwiKTtcbmNvbnN0IGRlbGV0ZUZvcm0gPSBkZWxldGVDYXJkTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcbmNvbnN0IGRlbGV0ZUNhcmRDbG9zZUJ0biA9IGRlbGV0ZUNhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XG5jb25zdCBkZWxldGVDYXJkQ2FuY2VsQnRuID0gZGVsZXRlQ2FyZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiLm1vZGFsX19jYW5jZWwtY2FyZC1idG5cIlxuKTtcblxuLy9UZW1wbGF0ZSBvYmplY3RzXG5jb25zdCBjYXJkVGVtcGxhdGUgPSBkb2N1bWVudFxuICAucXVlcnlTZWxlY3RvcihcIiNjYXJkLXRlbXBsYXRlXCIpXG4gIC5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZFwiKTtcblxuY29uc3QgY2FyZHNMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkc19fbGlzdFwiKTtcblxuZnVuY3Rpb24gZ2V0Q2FyZEVsZW1lbnQoZGF0YSkge1xuICBjb25zdCBjYXJkRWxlbWVudCA9IGNhcmRUZW1wbGF0ZS5jbG9uZU5vZGUodHJ1ZSk7XG5cbiAgY29uc3QgY2FyZFRpdGxlRWwgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpO1xuICBjb25zdCBjYXJkSW1hZ2VFbCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XG5cbiAgY2FyZEltYWdlRWwuc3JjID0gZGF0YS5saW5rO1xuICBjYXJkSW1hZ2VFbC5hbHQgPSBkYXRhLm5hbWU7XG4gIGNhcmRUaXRsZUVsLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuXG4gIGNvbnN0IGNhcmRMaWtlQnRuRWwgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnRuXCIpO1xuXG4gIGlmIChkYXRhLmlzTGlrZWQpIHtcbiAgICBjYXJkTGlrZUJ0bkVsLmNsYXNzTGlzdC5hZGQoXCJjYXJkX19saWtlLWJ0bl9hY3RpdmVcIik7XG4gIH0gZWxzZSB7XG4gICAgY2FyZExpa2VCdG5FbC5jbGFzc0xpc3QucmVtb3ZlKFwiY2FyZF9fbGlrZS1idG5fYWN0aXZlXCIpO1xuICB9XG5cbiAgY2FyZExpa2VCdG5FbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT5cbiAgICBoYW5kbGVMaWtlKGRhdGEuX2lkLCBjYXJkTGlrZUJ0bkVsKVxuICApO1xuXG4gIGNvbnN0IGNhcmREZWxldGVCdG5FbCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZGVsZXRlLWJ0blwiKTtcbiAgY2FyZERlbGV0ZUJ0bkVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgaGFuZGxlRGVsZXRlQ2FyZChjYXJkRWxlbWVudCwgZGF0YS5faWQpO1xuICB9KTtcblxuICBjYXJkSW1hZ2VFbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIHByZXZpZXdJbWFnZUVsLnNyYyA9IGRhdGEubGluaztcbiAgICBwcmV2aWV3SW1hZ2VFbC5hbHQgPSBkYXRhLm5hbWU7XG4gICAgcHJldmlld0NhcHRpb25FbC50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgICBvcGVuTW9kYWwocHJldmlld01vZGFsKTtcbiAgfSk7XG5cbiAgcmV0dXJuIGNhcmRFbGVtZW50O1xufVxuXG4vLyBIZWxwZXIgZnVuY3Rpb25zXG5jb25zdCBvcGVuTW9kYWwgPSAobW9kYWwpID0+IHtcbiAgbW9kYWwuY2xhc3NMaXN0LmFkZChcIm1vZGFsX2lzLW9wZW5lZFwiKTtcblxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBoYW5kbGVFc2NhcGVLZXkpO1xuXG4gIG1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBoYW5kbGVPdmVybGF5Q2xpY2spO1xufTtcblxuY29uc3QgY2xvc2VNb2RhbCA9IChtb2RhbCkgPT4ge1xuICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfaXMtb3BlbmVkXCIpO1xuXG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGhhbmRsZUVzY2FwZUtleSk7XG5cbiAgbW9kYWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZU92ZXJsYXlDbGljayk7XG59O1xuXG4vL2Z1bmN0aW9uIGhhbmRsZXIgZm9yIGNsb3NpbmcgbW9kYWxzXG5jb25zdCBoYW5kbGVFc2NhcGVLZXkgPSAoZXZ0KSA9PiB7XG4gIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgY29uc3Qgb3BlbmVkTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX2lzLW9wZW5lZFwiKTtcbiAgICBpZiAob3BlbmVkTW9kYWwpIHtcbiAgICAgIGNsb3NlTW9kYWwob3BlbmVkTW9kYWwpO1xuICAgIH1cbiAgfVxufTtcblxuY29uc3QgaGFuZGxlT3ZlcmxheUNsaWNrID0gKGV2dCkgPT4ge1xuICBpZiAoZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtb2RhbF9pcy1vcGVuZWRcIikpIHtcbiAgICBjbG9zZU1vZGFsKGV2dC50YXJnZXQpO1xuICB9XG59O1xuXG5kZWxldGVDYXJkQ2FuY2VsQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJkZWxldGUtY2FyZC1tb2RhbFwiKTtcbiAgY2xvc2VNb2RhbChtb2RhbCk7XG59KTtcblxuY29uc3QgaGFuZGxlRGVsZXRlQ2FyZCA9IChjYXJkRWxlbWVudCwgY2FyZElkKSA9PiB7XG4gIHNlbGVjdGVkQ2FyZCA9IGNhcmRFbGVtZW50O1xuICBzZWxlY3RlZENhcmRJZCA9IGNhcmRJZDtcblxuICBvcGVuTW9kYWwoZGVsZXRlQ2FyZE1vZGFsKTtcbn07XG5cbmNvbnN0IGhhbmRsZURlbGV0ZUNhcmRTdWJtaXQgPSAoZXZ0KSA9PiB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gIGNvbnN0IHN1Ym1pdEJ0biA9IGV2dC5zdWJtaXR0ZXI7XG4gIHNldEJ1dHRvblRleHQoc3VibWl0QnRuLCB0cnVlKTtcblxuICBhcGlcbiAgICAuZGVsZXRlQ2FyZChzZWxlY3RlZENhcmRJZClcbiAgICAudGhlbigoKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhcIkNhcmQgZGVsZXRlZFwiKTtcbiAgICAgIHNlbGVjdGVkQ2FyZC5yZW1vdmUoKTtcbiAgICAgIGNsb3NlTW9kYWwoZGVsZXRlQ2FyZE1vZGFsKTtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHNldEJ1dHRvblRleHQoc3VibWl0QnRuLCBmYWxzZSk7XG4gICAgfSk7XG59O1xuXG5jb25zdCBoYW5kbGVMaWtlID0gKGNhcmRJZCwgYnV0dG9uTGlrZWQpID0+IHtcbiAgY29uc3QgaXNMaWtlZCA9IGJ1dHRvbkxpa2VkLmNsYXNzTGlzdC5jb250YWlucyhcImNhcmRfX2xpa2UtYnRuX2FjdGl2ZVwiKTtcblxuICBpZiAoaXNMaWtlZCkge1xuICAgIGFwaVxuICAgICAgLmhhbmRsZUxpa2UoY2FyZElkLCBpc0xpa2VkKVxuICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICBidXR0b25MaWtlZC5jbGFzc0xpc3QucmVtb3ZlKFwiY2FyZF9fbGlrZS1idG5fYWN0aXZlXCIpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaChjb25zb2xlLmVycm9yKTtcbiAgfSBlbHNlIHtcbiAgICBhcGlcbiAgICAgIC5oYW5kbGVMaWtlKGNhcmRJZCwgaXNMaWtlZClcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgYnV0dG9uTGlrZWQuY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpa2UtYnRuX2FjdGl2ZVwiKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goY29uc29sZS5lcnJvcik7XG4gIH1cbn07XG5cbmxldCBzZWxlY3RlZENhcmQsIHNlbGVjdGVkQ2FyZElkO1xuXG4vL0Nsb3NlcyBhbGwgbW9kYWxzXG5jb25zdCBjbG9zZUJ1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XG5cbmNsb3NlQnV0dG9ucy5mb3JFYWNoKChidXR0b24pID0+IHtcbiAgY29uc3QgbW9kYWwgPSBidXR0b24uY2xvc2VzdChcIi5tb2RhbFwiKTtcblxuICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGNsb3NlTW9kYWwobW9kYWwpKTtcbn0pO1xuXG4vLyBFdmVudCBMaXN0ZW5lcnMgZm9yIEVkaXQgUHJvZmlsZSBNb2RhbFxuZWRpdFByb2ZpbGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgZWRpdFByb2ZpbGVOYW1lSW5wdXQudmFsdWUgPSBwcm9maWxlTmFtZUVsLnRleHRDb250ZW50O1xuICBlZGl0UHJvZmlsZURlc2NyaXB0aW9uSW5wdXQudmFsdWUgPSBwcm9maWxlRGVzY3JpcHRpb25FbC50ZXh0Q29udGVudDtcbiAgcmVzZXRWYWxpZGF0aW9uKFxuICAgIGVkaXRQcm9maWxlRm9ybSxcbiAgICBbZWRpdFByb2ZpbGVOYW1lSW5wdXQsIGVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dF0sXG4gICAgc2V0dGluZ3NcbiAgKTtcbiAgb3Blbk1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xufSk7XG5cbmVkaXRQcm9maWxlQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY2xvc2VNb2RhbChlZGl0UHJvZmlsZU1vZGFsKTtcbn0pO1xuXG5mdW5jdGlvbiBoYW5kbGVFZGl0UHJvZmlsZVN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgY29uc3Qgc3VibWl0QnRuID0gZXZ0LnN1Ym1pdHRlcjtcbiAgc2V0QnV0dG9uVGV4dChzdWJtaXRCdG4sIHRydWUpO1xuXG4gIGFwaVxuICAgIC5lZGl0VXNlckluZm8oe1xuICAgICAgbmFtZTogZWRpdFByb2ZpbGVOYW1lSW5wdXQudmFsdWUsXG4gICAgICBhYm91dDogZWRpdFByb2ZpbGVEZXNjcmlwdGlvbklucHV0LnZhbHVlLFxuICAgIH0pXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgIHByb2ZpbGVOYW1lRWwudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gICAgICBwcm9maWxlRGVzY3JpcHRpb25FbC50ZXh0Q29udGVudCA9IGRhdGEuYWJvdXQ7XG4gICAgICBjbG9zZU1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgLy8gc3VibWl0QnRuLnRleHRDb250ZW50ID0gXCJTYXZlXCI7XG4gICAgICBzZXRCdXR0b25UZXh0KHN1Ym1pdEJ0biwgZmFsc2UpO1xuICAgIH0pO1xufVxuXG5jb25zdCBoYW5kbGVQb3N0U3VibWl0ID0gKGV2dCkgPT4ge1xuICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgY29uc3Qgc3VibWl0QnRuID0gZXZ0LnN1Ym1pdHRlcjtcbiAgc2V0QnV0dG9uVGV4dChzdWJtaXRCdG4sIHRydWUpO1xuICBhcGlcbiAgICAucG9zdENhcmQoe1xuICAgICAgbGluazogbmV3UG9zdEltYWdlSW5wdXQudmFsdWUsXG4gICAgICBjYXB0aW9uOiBuZXdQb3N0RGVzY3JpcHRpb25JbnB1dC52YWx1ZSxcbiAgICB9KVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICBjb25zdCBjYXJkRWxlbWVudCA9IGdldENhcmRFbGVtZW50KGRhdGEpO1xuXG4gICAgICBjYXJkc0xpc3QucHJlcGVuZChjYXJkRWxlbWVudCk7XG5cbiAgICAgIG5ld1Bvc3RGb3JtLnJlc2V0KCk7XG5cbiAgICAgIGRpc2FibGVCdG4obmV3UG9zdFN1Ym1pdEJ0biwgc2V0dGluZ3MpO1xuXG4gICAgICBjbG9zZU1vZGFsKG5ld1Bvc3RNb2RhbCk7XG4gICAgfSlcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcilcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBzZXRCdXR0b25UZXh0KHN1Ym1pdEJ0biwgZmFsc2UpO1xuICAgIH0pO1xufTtcblxuZWRpdFByb2ZpbGVGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlRWRpdFByb2ZpbGVTdWJtaXQpO1xuXG4vLyBFdmVudCBMaXN0ZW5lcnMgZm9yIE5ldyBQb3N0IE1vZGFsXG5uZXdQb3N0QnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIG9wZW5Nb2RhbChuZXdQb3N0TW9kYWwpO1xufSk7XG5uZXdQb3N0Q2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY2xvc2VNb2RhbChuZXdQb3N0TW9kYWwpO1xufSk7XG5cbm5ld1Bvc3RGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlUG9zdFN1Ym1pdCk7XG5cbi8vIEV2ZW50IExpc3RlbmVycyBmb3IgYXZhdGFyIE1vZGFsXG5hdmF0YXJNb2RhbEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBvcGVuTW9kYWwoYXZhdGFyTW9kYWwpO1xufSk7XG5cbmF2YXRhckNsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGNsb3NlTW9kYWwoYXZhdGFyTW9kYWwpO1xufSk7XG5cbmF2YXRhckZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25zdCBzdWJtaXRCdG4gPSBldnQuc3VibWl0dGVyO1xuICBzZXRCdXR0b25UZXh0KHN1Ym1pdEJ0biwgdHJ1ZSk7XG4gIGFwaVxuICAgIC5lZGl0QXZhdGFySW5mbyh7XG4gICAgICBhdmF0YXI6IGF2YXRhcklucHV0LnZhbHVlLFxuICAgIH0pXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKGRhdGEuYXZhdGFyKTtcbiAgICAgIHByb2ZpbGVBdmF0YXJFbC5zcmMgPSBkYXRhLmF2YXRhcjtcbiAgICAgIGF2YXRhckZvcm0ucmVzZXQoKTtcbiAgICAgIGRpc2FibGVCdG4oYXZhdGFyU3VibWl0QnRuLCBzZXR0aW5ncyk7XG4gICAgICBjbG9zZU1vZGFsKGF2YXRhck1vZGFsKTtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHNldEJ1dHRvblRleHQoc3VibWl0QnRuLCBmYWxzZSk7XG4gICAgfSk7XG59KTtcblxuLy9ldmVudCBsaXN0ZW5lcnMgZm9yIERlbGV0ZSBDYXJkIE1vZGFsXG5kZWxldGVDYXJkQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY2xvc2VNb2RhbChkZWxldGVDYXJkTW9kYWwpO1xufSk7XG5cbmRlbGV0ZUZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVEZWxldGVDYXJkU3VibWl0KTtcblxuLy8gRW5hYmxlIHZhbGlkYXRpb25cblxuZW5hYmxlVmFsaWRhdGlvbihzZXR0aW5ncyk7XG4iLCJjbGFzcyBBcGkge1xuICBjb25zdHJ1Y3Rvcih7IGJhc2VVcmwsIGhlYWRlcnMgfSkge1xuICAgIC8vIGNvbnN0cnVjdG9yIGJvZHlcbiAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcbiAgICB0aGlzLl9oZWFkZXJzID0gaGVhZGVycztcbiAgfVxuXG4gIGdldEFwcEluZm8oKSB7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmdldEluaXRpYWxDYXJkcygpLCB0aGlzLmdldFVzZXJJbmZvKCldKTtcbiAgfVxuXG4gIGdldEluaXRpYWxDYXJkcygpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICBnZXRVc2VySW5mbygpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICBlZGl0VXNlckluZm8oeyBuYW1lLCBhYm91dCB9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgLy8gU2VuZCB0aGUgZGF0YSBpbiB0aGUgYm9keSBhcyBhIEpTT04gc3RyaW5nLlxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lLFxuICAgICAgICBhYm91dCxcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICBlZGl0QXZhdGFySW5mbyh7IGF2YXRhciB9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lL2F2YXRhcmAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIC8vIFNlbmQgdGhlIGRhdGEgaW4gdGhlIGJvZHkgYXMgYSBKU09OIHN0cmluZy5cbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgYXZhdGFyLFxuICAgICAgfSksXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIHBvc3RDYXJkKHsgbGluaywgY2FwdGlvbiB9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICAvLyBTZW5kIHRoZSBkYXRhIGluIHRoZSBib2R5IGFzIGEgSlNPTiBzdHJpbmcuXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIGxpbmssXG4gICAgICAgIG5hbWU6IGNhcHRpb24sXG4gICAgICB9KSxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgZGVsZXRlQ2FyZChpZCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2lkfWAsIHtcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIGhhbmRsZUxpa2UoaWQsIGlzTGlrZWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtpZH0vbGlrZXNgLCB7XG4gICAgICBtZXRob2Q6IGlzTGlrZWQgPyBcIkRFTEVURVwiIDogXCJQVVRcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIF9jaGVja1Jlc3BvbnNlKHJlcykge1xuICAgIC8vIGhhbmRsZSB0aGUgcmVzcG9uc2VcbiAgICBpZiAocmVzLm9rKSB7XG4gICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICB9XG4gICAgLy8gaWYgdGhlIHNlcnZlciByZXR1cm5zIGFuIGVycm9yLCByZWplY3QgdGhlIHByb21pc2VcbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gIH1cbn1cblxuLy8gZXhwb3J0IHRoZSBjbGFzc1xuZXhwb3J0IGRlZmF1bHQgQXBpO1xuIl0sIm5hbWVzIjpbInNldHRpbmdzIiwiZm9ybVNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsImlucHV0RXJyb3JDbGFzcyIsImVycm9yQ2xhc3MiLCJoaWRlSW5wdXRFcnJvciIsImZvcm1FbCIsImlucHV0RWwiLCJjb25maWciLCJlcnJvckVsIiwicXVlcnlTZWxlY3RvciIsImlkIiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwidGV4dENvbnRlbnQiLCJ0b2dnbGVCdXR0b25TdGF0ZSIsImlucHV0TGlzdCIsImJ1dHRvbkVsIiwic29tZSIsImlucHV0IiwidmFsaWRpdHkiLCJ2YWxpZCIsImhhc0ludmFsaWRJbnB1dCIsImRpc2FibGVCdG4iLCJkaXNhYmxlZCIsImFkZCIsImVuYWJsZVZhbGlkYXRpb24iLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJBcnJheSIsImZyb20iLCJhZGRFdmVudExpc3RlbmVyIiwiY2hlY2tJbnB1dFZhbGlkaXR5Iiwic2hvd0lucHV0RXJyb3IiLCJlcnJvck1lc3NhZ2UiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsInNldEJ1dHRvblRleHQiLCJidG4iLCJpc0xvYWRpbmciLCJkZWZhdWx0VGV4dCIsImxvYWRpbmdUZXh0IiwiYXBpIiwiY29uc3RydWN0b3IiLCJiYXNlVXJsIiwiaGVhZGVycyIsInRoaXMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiZ2V0QXBwSW5mbyIsIlByb21pc2UiLCJhbGwiLCJnZXRJbml0aWFsQ2FyZHMiLCJnZXRVc2VySW5mbyIsImZldGNoIiwidGhlbiIsIl9jaGVja1Jlc3BvbnNlIiwiZWRpdFVzZXJJbmZvIiwibmFtZSIsImFib3V0IiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJlZGl0QXZhdGFySW5mbyIsImF2YXRhciIsInBvc3RDYXJkIiwibGluayIsImNhcHRpb24iLCJkZWxldGVDYXJkIiwiaGFuZGxlTGlrZSIsImlzTGlrZWQiLCJyZXMiLCJvayIsImpzb24iLCJyZWplY3QiLCJzdGF0dXMiLCJhdXRob3JpemF0aW9uIiwiY2FyZHMiLCJwcm9maWxlIiwiaXRlbSIsImNhcmRFbGVtZW50IiwiZ2V0Q2FyZEVsZW1lbnQiLCJjYXJkc0xpc3QiLCJyZW5kZXJDYXJkIiwicHJvZmlsZU5hbWVFbCIsInByb2ZpbGVEZXNjcmlwdGlvbkVsIiwicHJvZmlsZUF2YXRhckVsIiwic3JjIiwiZWRpdFByb2ZpbGVOYW1lSW5wdXQiLCJ2YWx1ZSIsImVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dCIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImxvZyIsImVkaXRQcm9maWxlQnRuIiwiZWRpdFByb2ZpbGVNb2RhbCIsImVkaXRQcm9maWxlQ2xvc2VCdG4iLCJlZGl0UHJvZmlsZUZvcm0iLCJwcmV2aWV3TW9kYWwiLCJwcmV2aWV3SW1hZ2VFbCIsInByZXZpZXdDYXB0aW9uRWwiLCJuZXdQb3N0QnRuIiwibmV3UG9zdE1vZGFsIiwibmV3UG9zdFN1Ym1pdEJ0biIsIm5ld1Bvc3RDbG9zZUJ0biIsIm5ld1Bvc3RGb3JtIiwibmV3UG9zdEltYWdlSW5wdXQiLCJuZXdQb3N0RGVzY3JpcHRpb25JbnB1dCIsImF2YXRhck1vZGFsQnRuIiwiYXZhdGFyTW9kYWwiLCJhdmF0YXJTdWJtaXRCdG4iLCJhdmF0YXJDbG9zZUJ0biIsImF2YXRhckZvcm0iLCJhdmF0YXJJbnB1dCIsImRlbGV0ZUNhcmRNb2RhbCIsImRlbGV0ZUZvcm0iLCJkZWxldGVDYXJkQ2xvc2VCdG4iLCJkZWxldGVDYXJkQ2FuY2VsQnRuIiwiY2FyZFRlbXBsYXRlIiwiY29udGVudCIsImRhdGEiLCJjbG9uZU5vZGUiLCJjYXJkVGl0bGVFbCIsImNhcmRJbWFnZUVsIiwiYWx0IiwiY2FyZExpa2VCdG5FbCIsIl9pZCIsImhhbmRsZURlbGV0ZUNhcmQiLCJvcGVuTW9kYWwiLCJtb2RhbCIsImhhbmRsZUVzY2FwZUtleSIsImhhbmRsZU92ZXJsYXlDbGljayIsImNsb3NlTW9kYWwiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiZXZ0Iiwia2V5Iiwib3BlbmVkTW9kYWwiLCJ0YXJnZXQiLCJjb250YWlucyIsImdldEVsZW1lbnRCeUlkIiwiY2FyZElkIiwic2VsZWN0ZWRDYXJkIiwic2VsZWN0ZWRDYXJkSWQiLCJidXR0b25MaWtlZCIsImVycm9yIiwiYnV0dG9uIiwiY2xvc2VzdCIsInJlc2V0VmFsaWRhdGlvbiIsInByZXZlbnREZWZhdWx0Iiwic3VibWl0QnRuIiwic3VibWl0dGVyIiwiZmluYWxseSIsInByZXBlbmQiLCJyZXNldCJdLCJzb3VyY2VSb290IjoiIn0=